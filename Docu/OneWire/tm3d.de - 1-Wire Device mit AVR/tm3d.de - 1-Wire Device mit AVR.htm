<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html slick-uniqueid="3" xmlns="http://www.w3.org/1999/xhtml" xml:lang="de-de" lang="de-de"><head>
		  <!-- base href="http://www.tm3d.de/index.php/1-wire-device-mit-avr" -->
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="keywords" content="CD Herstellung, CD Produktion, cd-produktion, CD Verpackungen, CD verpackung, cd bedruckung, DVD Herstellung, dvd-herstellung, dvd produktion, presswerk, DVD, CD, CD-ROM, CD-Audio, cd kopie, dvd kopie, cd fertigung, dvd fertigung, cd cover, cd-cover, cd brennen, cd-rom Herstellung, CD-Extra, CD-Herstellung, CD-Pressung, Duplikation, Vervielfältigung, Vervielfaeltigung, Vervielfältgung, compact-disc, compactdisc, Grafikservice, MPEG-2 Encodierung, DVD-Authoring, CD-ROM, CD-Audio, CD-COVER, cd Replication, CD Duplication, compact-disc, compactdisc, manufacturing cd, unique media, unique, media, CD production, DVD production, CD Digitaldruck, DVD Presswerk, DVD Verpackungen, Kleinserie, CD-R Bedruckung, CD Duplikation, CD Duplikationen, CD Kopien, DVD Authoring, cd drucker, cd dvd presswerk, cd fertigung, cd mailing, CD verpackung, cd-r kopie, Druck auf CD-R, DVD Authoring, dvd duplizieren, dvd kopie, dvd label drucken, dvd presswerk, dvd-herstellung, dvd-pressung, dvd-produktion, dvd-r kopie, herstellung dvd, Digitaldruck, Booklet, Inlay, Einleger, Cover-Card, Jewelbox, Superjewelbox, DVD-Kopie, cd-herstellung, cd-verpackung, Maxi-CD, Maxi, Grafik, kleinserie, kleinserien, small series, kleinserien-produktion, Grafik design, Coverdesign, Filmproduktion, Postproduktion, Computerschnitt, Farbkorrektur, Videoschnitt, Filmschnitt, Vertonung, DV, HD, Video Konvertierung, Video Conversion, Chemnitz, Videokonvertierung, Videobearbeitung, Haustechnik, Mikrocontroller, 1-Wire, Onewire, DS2438, DS18B20, HIH4030, HIH5030, Atmel, AVR, 868, Heizungssteuerung, Luftfeuchte, Chemnitz, 1wire counter, unique serial code, unique code, unique 64–bit code, 1-Wire family code, Elektronik-Projekte, BMP085, BMP180, Barometer">
  <meta name="description" content="Medienservice (CD/DVD Design und Produktion von Kleinserien)/ Viele Interessante Elektronik-Projekte mit 1-Wire, AVR, Haustechnik usw. ">
  <meta name="generator" content="Joomla! - Open Source Content Management">
  <title>tm3d.de - 1-Wire Device mit AVR</title>
  <link href="http://www.tm3d.de/index.php/1-wire-device-mit-avr?format=feed&amp;type=rss" rel="alternate" type="application/rss+xml" title="RSS 2.0">
  <link href="http://www.tm3d.de/index.php/1-wire-device-mit-avr?format=feed&amp;type=atom" rel="alternate" type="application/atom+xml" title="Atom 1.0">
  <link href="http://www.tm3d.de/templates/1sr_170_1/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon">
  <link rel="stylesheet" href="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/mediaboxAdvBlack.css" type="text/css" media="screen">
  <link rel="stylesheet" href="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/style.css" type="text/css">
  <link rel="stylesheet" href="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/shCore.css" type="text/css">
  <link rel="stylesheet" href="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/shThemeDefault.css" type="text/css">
  <script src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/mootools-core.js" type="text/javascript"></script>
  <script src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/core.js" type="text/javascript"></script>
  <script src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/mootools-more.js" type="text/javascript"></script>
  <script src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/mediaboxAdv.js" type="text/javascript"></script>
  <script src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/caption.js" type="text/javascript"></script>
  <script src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/shCore.js" type="text/javascript"></script>
  <script src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/shBrushCpp.js" type="text/javascript"></script>
  <script type="text/javascript">
window.addEvent('load', function() {
				new JCaption('img.caption');
			});
SyntaxHighlighter.config.strings.expandSource = "Source anzeigen";
SyntaxHighlighter.config.strings.viewSource = "Source anzeigen";
SyntaxHighlighter.config.strings.copyToClipboard = "in die Zwischenablage kopieren";
SyntaxHighlighter.config.strings.copyToClipboardConfirmation = "Sourcecode ist nun in der Zwischenablage";
SyntaxHighlighter.config.strings.print = "Drucken";
SyntaxHighlighter.config.clipboardSwf = "/plugins/content/smarthighlighter/syntaxhighlighter2/scripts/clipboard.swf";SyntaxHighlighter.all();
window.addEvent('domready', function() {
			$$('.hasTip').each(function(el) {
				var title = el.get('title');
				if (title) {
					var parts = title.split('::', 2);
					el.store('tip:title', parts[0]);
					el.store('tip:text', parts[1]);
				}
			});
			var JTooltips = new Tips($$('.hasTip'), { maxTitleChars: 50, fixed: false});
		});
  </script>

		
		
				<script type="text/javascript" src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/stylechanger.js"></script>
				
		<link rel="stylesheet" href="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/1008-24-static-grid.css" type="text/css">
		
					<link rel="stylesheet" href="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/template_general2.css" type="text/css">
			<link href="http://www.tm3d.de/templates/1sr_170_1/images/general2/favicon.ico" rel="shortcut icon">
				
		
		<link rel="stylesheet" type="text/css" href="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/superfish.css" media="screen">
		<script type="text/javascript" src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/jquery-1.js"></script>
		<script type="text/javascript" src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/hoverIntent.js"></script>
		<script type="text/javascript" src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/superfish.js"></script>
		<script type="text/javascript">

			// initialise plugins
			jQuery(function(){
				jQuery('#header-nav ul.menu').addClass("sf-menu");
				
				var sfOptions = {
					delay : 800, 
					autoArrows : true				};
				
				jQuery('#header-nav ul.menu').superfish(sfOptions);
			});

		</script>
	</head>
	<body style="font-size: 75%;">
		
		<style type="text/css">

		
		
				
					
			/* override superfish.css */
			
			.sf-menu a {border: none; padding: 8px 10px}
			
			.sf-menu li {background: url(/templates/1sr_170_1/images/general2/h3-background.jpg) repeat-x;}
			
			.sf-menu li.sfHover ul {top: 30px}
			.sf-menu li li, .sf-menu li li li {background: #eeeeee;}
			
			.sf-menu li:hover, .sf-menu li li.sfHover, .sf-menu a:focus, .sf-menu a:hover, .sf-menu a:active {background: #ffffff;}
			
			.sf-menu li.sfHover {background: url(/templates/1sr_170_1/images/general2/h3-background.jpg) repeat-x;}
			
			.sf-menu li li {zoom: 1; filter: alpha(opacity=100); opacity: 1;}
			
			.sf-sub-indicator {background: url('/templates/1sr_170_1/images/general2/header-nav-arrows.png') no-repeat -10px -100px; /* 8-bit indexed alpha png. IE6 gets solid image only */}
			
				
		</style>
		
		<div class="container_24">
			<!-- header -->
			
			<div class="grid_24" id="header-top">
															<div id="search"></div>
										<div id="fontsize">
						<script type="text/javascript">
							//<![CDATA[
								document.write('<a href="/index.php" title="gro&szlig;e Schrift" onclick="bigFontSize(); return false;"><img src="/templates/1sr_170_1/images/font_size_big.png" alt="gro&szlig;e Schrift" /></a>');
								document.write('<a href="/index.php" title="Schrift zur&uuml;cksetzen" onclick="resetFontSize(); return false;"><img src="/templates/1sr_170_1/images/font_size_normal.png" alt="Schrift zur&uuml;cksetzen" /></a>');
								document.write('<a href="/index.php" title="kleine Schrift" onclick="smallFontSize(); return false;"><img src="/templates/1sr_170_1/images/font_size_small.png" alt="kleine Schrift" /></a></p>');
							//]]>
						</script><a href="http://www.tm3d.de/index.php" title="große Schrift" onclick="bigFontSize(); return false;"><img src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/font_size_big.png" alt="große Schrift"></a><a href="http://www.tm3d.de/index.php" title="Schrift zurücksetzen" onclick="resetFontSize(); return false;"><img src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/font_size_normal.png" alt="Schrift zurücksetzen"></a><a href="http://www.tm3d.de/index.php" title="kleine Schrift" onclick="smallFontSize(); return false;"><img src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/font_size_small.png" alt="kleine Schrift"></a><p></p>
					</div>
			</div>  
			<div class="clear"></div>
			
			<!-- logo -->
			<div class="grid_24" id="logo">
				<a href="http://www.tm3d.de/" title="Home">
											<img src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/logo.jpg" alt="wedding, marriage, engagement, rings, wedding dress, flowers, roses logo" title="tm3d.de">
									</a>
				
			</div>
			<div class="clear"></div>
						<div class="clear"></div>
			
			
			
			
			
			<!-- header navigation -->
			<div class="grid_24" id="header-nav">
						<div class="moduletable_menu">
					<h3>Hauptmenü</h3>
					
<ul class="menu sf-menu sf-js-enabled sf-shadow">
<li class="item-101"><a href="http://www.tm3d.de/">Home</a></li><li class="item-152"><a href="http://www.tm3d.de/index.php/arbeit">Berufliche Forschung</a></li><li class="item-151"><a href="http://www.tm3d.de/index.php/newsletter">Newsletter</a></li><li class="item-128"><a href="https://www.tobynet.de/index.php/login-s">Login</a></li><li class="item-102"><a href="http://www.tm3d.de/index.php/impressum1">Impressum</a></li></ul>
		</div>
	
			</div>
			<div class="clear"></div>
			
			<!-- breadcrumb -->
						<div class="grid_24" id="bread">
						<div class="moduletable">
					
<div class="breadcrumbs">
<span class="showHere">Aktuelle Seite: </span><span>1-Wire Device mit AVR</span></div>
		</div>
	
			</div>
			<div class="clear"></div>
						
							<div class="grid_5" id="left">		<div class="moduletable">
					<h3>Medienservice</h3>
					
<ul class="menu">
<li class="item-104"><a href="http://www.tm3d.de/index.php/dienstleistungen1">Dienstleistungen</a></li><li class="item-126"><a href="http://www.tm3d.de/index.php/kontakt">Kontakt</a></li></ul>
		</div>
			<div class="moduletable">
					<h3>Elektr. Projekte</h3>
					
<ul class="menu">
<li class="item-105"><a href="http://www.tm3d.de/index.php/1wire-feuchtesensor">1-Wire Feuchtesensor</a></li><li class="item-129"><a href="http://www.tm3d.de/index.php/antennen-fuer-868-mhz">Antennen für 868 MHz</a></li><li class="item-130 current active"><a href="http://www.tm3d.de/index.php/1-wire-device-mit-avr">1-Wire Device mit AVR</a></li><li class="item-155"><a href="http://www.tm3d.de/index.php/1-wire-barometer">1-Wire Barometer</a></li><li class="item-131"><a href="http://www.tm3d.de/index.php/tools">Tools</a></li><li class="item-154"><a href="http://www.tm3d.de/index.php/arm-als-homeserver">ARM als Homeserver</a></li></ul>
		</div>
			<div class="moduletable">
					<h3>Wetter</h3>
					
<ul class="menu">
<li class="item-184 parent"><a href="http://www.tm3d.de/index.php/bo/blitzkarten/dynamische-karte">Blitzortung</a></li><li class="item-205"><a href="http://www.tm3d.de/index.php/hochwasser-juni-2013">Hochwasser Juni 2013</a></li></ul>
		</div>
			<div class="moduletable">
					<h3>Wetter in Chemnitz</h3>
					

<div class="custom">
	<style type="text/css">
div.bgfixed {
  /*background-image:url(/images/film.jpg); background-repeat:repeat; background-position:center center;
  background-attachment:fixed;*/
 background-color: #ffe7bd;
font-weight: normal;
text-align: left;
padding: 3px 3px 3px 10px;
  
}
</style>
<div class="bgfixed">
<p>Chemnitz Erfenschlag<br>320m (ü. NN)</p> 
Temperatur: 14.5 °C<br>Luftfeuchte: 71.0 %<br>Luftdruck: 1011.9 hPa<br>Niederschlag (24h): 1.5 mm<br>Niederschlag (30d): 60.8 mm<br><p> </p></div>
</div>
		</div>
			<div class="moduletable">
					

<div class="custom">
	<style type="text/css">
div.bgfixed {
/*  background-image:url(/images/1147977_vintage_fountain_pen_1.jpg);  */
 background-color: #ffe7bd;
font-weight: normal;
text-align: left;
height: 120px;
padding: 10px 10px 3px 10px;
  
}
</style>
<div class="bgfixed">
<p>Über neue Beiträge automatisch informiert werden:</p>
<p><a href="http://www.tm3d.de/index.php/newsletter/user/modify">Newsletter aponnieren</a></p>
<a class="linkthumb" target="_blank" title="" rel="lightbox[id0]" href="http://www.tm3d.de/images/1147977_vintage_fountain_pen_1.jpg"><img src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/a6cd9bad555435eeae43f021d78b9416.jpg" class="thumb" align="right" height="80" width="120"></a>
</div>


</div>
		</div>
	</div>
				<div class="grid_19" id="content_big">
<div id="system-message-container">
</div><div class="blog">

		<h2>
							<span class="subheading-category">1-Wire Device mit AVR-Mikrocontroller</span>
			</h2>
	






<div class="items-leading">
			<div class="leading-0">
			


	


<h1>Beweggründe<br><br></h1>
<p>Seit ich erfahren habe, das der 1-Wire Baustein DS2423 (Zähler) nicht
 mehr produziert wird kam mir die Idee, ihn mit Hilfe eines 
Mikrocontrollers nachzubauen. Anfang 2012 habe ich mich intensiver mit 
den AVR-Controllern von Atmel befasst und es hat mich ziemlich 
begeistert, was man damit alles anstellen kann.</p>
<p>Im Internet gab es schon verschiedene Ansätze einen 1-Wire-Slave mit 
Atmel-Controllern aber die kamen mir alle ein bisschen zu groß und zu 
unübersichtlich vor. Auch die Vorstellung, selbst eigene Geräte für den 
1-Wire-Bus zu kreieren, fasziniert mich sehr. So habe ich probiert, 
optimiert und korrigiert und heraus kam ein sehr kleines und robustes 
Stückchen Code, welches auch noch an meinem 50m 1-Wire-Bus mit mehr als 
40 Slaves fehlerfrei funktioniert.</p>
<p></p><div class="jcomments-links"> <a class="comments-link" href="http://www.tm3d.de/index.php/1-wire-device-mit-avr/11-beweggruende#addcomment" title="Kommentar schreiben">Kommentar schreiben</a> </div>



<div class="item-separator"></div>
		</div>
			</div>

			<div class="items-row cols-2 row-0">
		<div class="item column-1">
		


	


<p><a name="sourcecode"></a></p>
<h1>Der <span class="st"><span><span>Source</span></span></span><span><span>code</span> für 1-<span>Wire</span> Devices mit AVR-Mikrocontrollern<br></span></h1>
<p>Die Aktuelle Version ist nun die 1.2</p>
<p><span><span>Changelog</span>:</span></p>
<p>
</p><table border="0">
<tbody>
<tr>
<td style="background-color: #ffd238;" align="left" valign="top">Version</td>
<td style="background-color: #ffd238;" align="left" valign="top"><span>Veränderung zur vorhergehenden <span>Verison</span></span></td>
</tr>
<tr>
<td style="background-color: #ffd238;" align="left" valign="top">1.2</td>
<td style="background-color: #ffd238;" align="left" valign="top">
<p><span>Verbesserung des <span>Timings</span></span><br>lwmode wird gleich am Anfang von PIN_INT zurückgesetzt dadurch bessere Stabilität bei DS9490</p>
</td>
</tr>
<tr>
<td style="background-color: #ffd238;" align="left" valign="top"><a href="http://www.tm3d.de/index.php/1-wire-device-mit-avr/22-elektronische-projekte/alte-sachen/22-avr-owdevice-v11">1.1</a></td>
<td style="background-color: #ffd238;" align="left" valign="top"><span>Umstrukturierung für bessere Anpassung. <span>Skip</span>-Rom und <span>Read</span>-Rom</span></td>
</tr>
<tr>
<td style="background-color: #ffd238;" align="left" valign="top"><a href="http://www.tm3d.de/index.php/1-wire-device-mit-avr/22-elektronische-projekte/alte-sachen/19-avr-owdevice-v1">1.0</a></td>
<td style="background-color: #ffd238;" align="left" valign="top"></td>
</tr>
</tbody>
</table>
<p></p>
<p>Der Code wird wie immer unter <a href="http://www.gnu.org/licenses/">GPL</a><span>-Lizenz veröffentlicht. Eine korrekte 1-<span>Wire</span>-ID für das Gerät kann mit dem </span><a href="http://www.tm3d.de/index.php/tools#berechnungid">CRC Rechner</a> auf meiner Homepage erstellt werden. Das erste Byte beschreibt die Gerätefamilie und sollte nicht verändert werden.</p>
<h2>DS18B20 für ATtiny13 und ATtiny25</h2>
<p><span>Zunächst habe ich versuche mit dem DS18B20 unternommen. Hier 
der Code für den ATTiny13 oder ATTiny25. Er passt gerade so in den 1k 
Speicher. Als Wert für die Temperatur wird bei dem ATTiny13 die Spannung
 an PB2 gemessen. Der ATTiny25 hat ein internes Thermometer. Dieses wird
 16 mal ausgelesen und summiert. Das LSB entspricht ein Grad 
Veränderung, durch die Addition wird der Wert mal 16 genommen und 
entspricht so der Angabe in den Registern des DS18B20. Es muss noch ein <span>Kalibrierwert</span>
 abgezogen werden. Leider erwärmt sich der ATTiny25 wahrscheinlich 
selbst ziemlich stark, so dass keine genaue Messung möglich war. Also 
eher ein Schulbeispiel :-).</span><span></span></p>
<div class="syntaxhighlighter  " id="highlighter_694473"><div class="bar"><div class="toolbar"><a class="item viewSource" style="width: 16px; height: 16px;" title="Source anzeigen" href="#viewSource">Source anzeigen</a><div class="item copyToClipboard"><embed id="highlighter_694473_clipboard" type="application/x-shockwave-flash" title="in die Zwischenablage kopieren" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_694473" menu="false" src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/clipboard.swf" height="16" width="16"></div><a class="item printSource" style="width: 16px; height: 16px;" title="Drucken" href="#printSource">Drucken</a><a class="item about" style="width: 16px; height: 16px;" title="?" href="#about">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>001</code></td><td class="content"><code class="comments">//owdevice - A small 1-Wire emulator for AVR Microcontroller</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>002</code></td><td class="content"><code class="comments">//</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>003</code></td><td class="content"><code class="comments">//Copyright (C) 2012&nbsp; Tobias Mueller mail (at) tobynet.de</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>004</code></td><td class="content"><code class="comments">//</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>005</code></td><td class="content"><code class="comments">//This program is free software: you can redistribute it and/or modify</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>006</code></td><td class="content"><code class="comments">//it under the terms of the GNU General Public License as published by</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>007</code></td><td class="content"><code class="comments">//the Free Software Foundation, either version 3 of the License, or</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>008</code></td><td class="content"><code class="comments">// any later version.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>009</code></td><td class="content"><code class="comments">//</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>010</code></td><td class="content"><code class="comments">//This program is distributed in the hope that it will be useful,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>011</code></td><td class="content"><code class="comments">//but WITHOUT ANY WARRANTY; without even the implied warranty of</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>012</code></td><td class="content"><code class="comments">//MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&nbsp; See the</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>013</code></td><td class="content"><code class="comments">//GNU General Public License for more details.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>014</code></td><td class="content"><code class="comments">//</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>015</code></td><td class="content"><code class="comments">//You should have received a copy of the GNU General Public License</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>016</code></td><td class="content"><code class="comments">//along with this program.&nbsp; If not, see &lt;<a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>&gt;.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>017</code></td><td class="content"><code class="comments">//</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>018</code></td><td class="content"><code class="comments">//</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>019</code></td><td class="content"><code class="comments">//VERSION 1.2 DS18B20&nbsp; ATTINY13 (AD input) and ATTINY25 (internal sensor)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>020</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>021</code></td><td class="content"><code class="comments">//FOR MAKE by hand</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>022</code></td><td class="content"><code class="comments">/*</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>023</code></td><td class="content"><code class="comments">avr-gcc -mmcu=attiny13 -O2 -c [name].c</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>024</code></td><td class="content"><code class="comments">avr-gcc.exe -mmcu=attiny13&nbsp; [name].o -o [name].elf</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>025</code></td><td class="content"><code class="comments">avr-objcopy -O ihex&nbsp; [name].elf [name].hex</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>026</code></td><td class="content"><code class="comments">*/</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>027</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>028</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>029</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>030</code></td><td class="content"><code class="preprocessor">#include &lt;avr/io.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>031</code></td><td class="content"><code class="preprocessor">#include &lt;avr/interrupt.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>032</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>033</code></td><td class="content"><code class="preprocessor">#if defined(__AVR_ATtiny13A__) || defined(__AVR_ATtiny13__)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>034</code></td><td class="content"><code class="comments">// OW_PORT Pin 6&nbsp; - PB1</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>035</code></td><td class="content"><code class="comments">//Analog input PB2</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>036</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>037</code></td><td class="content"><code class="comments">//OW Pin</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>038</code></td><td class="content"><code class="preprocessor">#define OW_PORT PORTB //1 Wire Port</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>039</code></td><td class="content"><code class="preprocessor">#define OW_PIN PINB //1 Wire Pin as number</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>040</code></td><td class="content"><code class="preprocessor">#define OW_PORTN (1&lt;&lt;PINB1)&nbsp; //Pin as bit in registers</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>041</code></td><td class="content"><code class="preprocessor">#define OW_PINN (1&lt;&lt;PINB1)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>042</code></td><td class="content"><code class="preprocessor">#define OW_DDR DDRB&nbsp; //pin direction register</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>043</code></td><td class="content"><code class="preprocessor">#define SET_LOW OW_DDR|=OW_PINN;OW_PORT&amp;=~OW_PORTN;&nbsp; //set 1-Wire line to low</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>044</code></td><td class="content"><code class="preprocessor">#define RESET_LOW {OW_DDR&amp;=~OW_PINN;}&nbsp; //set 1-Wire pin as input</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>045</code></td><td class="content"><code class="comments">//Pin interrupt </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>046</code></td><td class="content"><code class="preprocessor">#define EN_OWINT {GIMSK|=(1&lt;&lt;INT0);GIFR|=(1&lt;&lt;INTF0);}&nbsp; //enable interrupt </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>047</code></td><td class="content"><code class="preprocessor">#define DIS_OWINT&nbsp; GIMSK&amp;=~(1&lt;&lt;INT0);&nbsp; //disable interrupt</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>048</code></td><td class="content"><code class="preprocessor">#define SET_RISING MCUCR=(1&lt;&lt;ISC01)|(1&lt;&lt;ISC00);&nbsp; //set interrupt at rising edge</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>049</code></td><td class="content"><code class="preprocessor">#define SET_FALLING MCUCR=(1&lt;&lt;ISC01); //set interrupt at falling edge</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>050</code></td><td class="content"><code class="preprocessor">#define CHK_INT_EN (GIMSK&amp;(1&lt;&lt;INT0))==(1&lt;&lt;INT0) //test if interrupt enabled</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>051</code></td><td class="content"><code class="preprocessor">#define PIN_INT ISR(INT0_vect)&nbsp; // the interrupt service routine</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>052</code></td><td class="content"><code class="comments">//Timer Interrupt</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>053</code></td><td class="content"><code class="preprocessor">#define EN_TIMER {TIMSK0 |= (1&lt;&lt;TOIE0); TIFR0|=(1&lt;&lt;TOV0);} //enable timer interrupt</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>054</code></td><td class="content"><code class="preprocessor">#define DIS_TIMER TIMSK0&nbsp; &amp;= ~(1&lt;&lt;TOIE0); // disable timer interrupt</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>055</code></td><td class="content"><code class="preprocessor">#define TCNT_REG TCNT0&nbsp; //register of timer-counter</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>056</code></td><td class="content"><code class="preprocessor">#define TIMER_INT ISR(TIM0_OVF_vect) //the timer interrupt service routine</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>057</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>058</code></td><td class="content"><code class="comments">//Initializations of AVR</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>059</code></td><td class="content"><code class="preprocessor">#define INIT_AVR CLKPR=(1&lt;&lt;CLKPCE);\</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>060</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">CLKPR=0;</code><code class="comments">/*9.6Mhz*/</code><code class="plain">\</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>061</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TIMSK0=0;\</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>062</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">GIMSK=(1&lt;&lt;INT0);</code><code class="comments">/*set direct GIMSK register*/</code><code class="plain">\</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>063</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCCR0B=(1&lt;&lt;CS00)|(1&lt;&lt;CS01); </code><code class="comments">/*9.6mhz /64 couse 8 bit Timer interrupt every 6,666us*/</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>064</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>065</code></td><td class="content"><code class="comments">//Setup Temp Measurement DS18B20</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>066</code></td><td class="content"><code class="preprocessor">#define INIT_TEMP&nbsp;&nbsp; DDRB&amp;=~(1&lt;&lt;PINB2); \</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>067</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">ADMUX=(1&lt;&lt;MUX0); \</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>068</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">ADCSRA= (1&lt;&lt;ADEN) | (1&lt;&lt;ADPS2) | (1&lt;&lt;ADPS1) | (1&lt;&lt;ADPS0);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>069</code></td><td class="content"><code class="preprocessor">#define CONV_TEMP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ADCSRA|=(1&lt;&lt;ADSC); \</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>070</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">while</code> <code class="plain">((ADCSRA&amp;(1&lt;&lt;ADSC))!=0) {}\</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>071</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">scratchpad[0]=ADCL;\</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>072</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">scratchpad[1]=ADCH;\</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>073</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>074</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>075</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>076</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>077</code></td><td class="content"><code class="comments">//Times</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>078</code></td><td class="content"><code class="preprocessor">#define OWT_MIN_RESET 51 //minimum duration of the Reset impulse</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>079</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>080</code></td><td class="content"><code class="preprocessor">#define OWT_RESET_PRESENCE 4 //time between rising edge of reset impulse and presence impulse</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>081</code></td><td class="content"><code class="preprocessor">#define OWT_PRESENCE 20 //duration of the presence impulse</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>082</code></td><td class="content"><code class="preprocessor">#define OWT_READLINE 4&nbsp; //duration from master low to read the state of 1-Wire line</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>083</code></td><td class="content"><code class="preprocessor">#define OWT_LOWTIME 4 //length of low </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>084</code></td><td class="content"><code class="preprocessor">#endif</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>085</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>086</code></td><td class="content"><code class="preprocessor">#ifdef __AVR_ATtiny25__ </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>087</code></td><td class="content"><code class="comments">// OW_PORT Pin 7&nbsp; - PB2</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>088</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>089</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>090</code></td><td class="content"><code class="comments">//OW Pin</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>091</code></td><td class="content"><code class="preprocessor">#define OW_PORT PORTB //1 Wire Port</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>092</code></td><td class="content"><code class="preprocessor">#define OW_PIN PINB //1 Wire Pin as number</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>093</code></td><td class="content"><code class="preprocessor">#define OW_PORTN (1&lt;&lt;PINB2)&nbsp; //Pin as bit in registers</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>094</code></td><td class="content"><code class="preprocessor">#define OW_PINN (1&lt;&lt;PINB2)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>095</code></td><td class="content"><code class="preprocessor">#define OW_DDR DDRB&nbsp; //pin direction register</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>096</code></td><td class="content"><code class="preprocessor">#define SET_LOW OW_DDR|=OW_PINN;OW_PORT&amp;=~OW_PORTN;&nbsp; //set 1-Wire line to low</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>097</code></td><td class="content"><code class="preprocessor">#define RESET_LOW {OW_DDR&amp;=~OW_PINN;}&nbsp; //set 1-Wire pin as input</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>098</code></td><td class="content"><code class="comments">//Pin interrupt </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>099</code></td><td class="content"><code class="preprocessor">#define EN_OWINT {GIMSK|=(1&lt;&lt;INT0);GIFR|=(1&lt;&lt;INTF0);}&nbsp; //enable interrupt </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>100</code></td><td class="content"><code class="preprocessor">#define DIS_OWINT&nbsp; GIMSK&amp;=~(1&lt;&lt;INT0);&nbsp; //disable interrupt</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>101</code></td><td class="content"><code class="preprocessor">#define SET_RISING MCUCR=(1&lt;&lt;ISC01)|(1&lt;&lt;ISC00);&nbsp; //set interrupt at rising edge</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>102</code></td><td class="content"><code class="preprocessor">#define SET_FALLING MCUCR=(1&lt;&lt;ISC01); //set interrupt at falling edge</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>103</code></td><td class="content"><code class="preprocessor">#define CHK_INT_EN (GIMSK&amp;(1&lt;&lt;INT0))==(1&lt;&lt;INT0) //test if interrupt enabled</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>104</code></td><td class="content"><code class="preprocessor">#define PIN_INT ISR(INT0_vect)&nbsp; // the interrupt service routine</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>105</code></td><td class="content"><code class="comments">//Timer Interrupt</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>106</code></td><td class="content"><code class="preprocessor">#define EN_TIMER {TIMSK |= (1&lt;&lt;TOIE0); TIFR|=(1&lt;&lt;TOV0);} //enable timer interrupt</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>107</code></td><td class="content"><code class="preprocessor">#define DIS_TIMER TIMSK&nbsp; &amp;= ~(1&lt;&lt;TOIE0); // disable timer interrupt</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>108</code></td><td class="content"><code class="preprocessor">#define TCNT_REG TCNT0&nbsp; //register of timer-counter</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>109</code></td><td class="content"><code class="preprocessor">#define TIMER_INT ISR(TIM0_OVF_vect) //the timer interrupt service routine</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>110</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>111</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>112</code></td><td class="content"><code class="preprocessor">#define OWT_MIN_RESET 51</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>113</code></td><td class="content"><code class="preprocessor">#define OWT_RESET_PRESENCE 4</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>114</code></td><td class="content"><code class="preprocessor">#define OWT_PRESENCE 20 </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>115</code></td><td class="content"><code class="preprocessor">#define OWT_READLINE 3 //for fast master, 4 for slow master and long lines</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>116</code></td><td class="content"><code class="preprocessor">#define OWT_LOWTIME 3 //for fast master, 4 for slow master and long lines </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>117</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>118</code></td><td class="content"><code class="comments">//Initializations of AVR</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>119</code></td><td class="content"><code class="preprocessor">#define INIT_AVR CLKPR=(1&lt;&lt;CLKPCE); \</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>120</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">CLKPR=0; </code><code class="comments">/*8Mhz*/</code>&nbsp; <code class="plain">\</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>121</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TIMSK=0; \</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>122</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">GIMSK=(1&lt;&lt;INT0);&nbsp; </code><code class="comments">/*set direct GIMSK register*/</code> <code class="plain">\</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>123</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCCR0B=(1&lt;&lt;CS00)|(1&lt;&lt;CS01); </code><code class="comments">/*8mhz /64 couse 8 bit Timer interrupt every 8us*/</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>124</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>125</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>126</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>127</code></td><td class="content"><code class="comments">//Setup Temp Measurement DS18B20 intern sensor</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>128</code></td><td class="content"><code class="preprocessor">#define INIT_TEMP&nbsp; ADMUX=(1&lt;&lt;REFS1)|(1&lt;&lt;MUX3)|(1&lt;&lt;MUX2)|(1&lt;&lt;MUX1)|(1&lt;&lt;MUX0); \</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>129</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">ADCSRA=(1&lt;&lt;ADEN)|(1&lt;&lt;ADPS2)|(1&lt;&lt;ADPS1)|(1&lt;&lt;ADPS0); </code><code class="comments">/*ADC Freq: ~63khz*/</code> <code class="plain">\</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>130</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">ADCSRB=0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>131</code></td><td class="content"><code class="preprocessor">#define CONV_TEMP&nbsp;&nbsp; { uint8_t tc; int16_t sum=0; \</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>132</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">for</code><code class="plain">(tc=0;tc&lt;0x10;tc++) { \</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>133</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">ADCSRA|=(1&lt;&lt;ADSC)|(1&lt;&lt;ADIF);\</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>134</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">while</code><code class="plain">(ADCSRA&amp;(1&lt;&lt;ADSC));\</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>135</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">sum=sum+ADC; \</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>136</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} \</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>137</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">sum=sum-0xDAF;</code><code class="comments">/*calibration&nbsp; 0x010 are 1 K*/</code><code class="plain">\</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>138</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">/*sum=(sum&lt;&lt;4);*/</code>&nbsp; <code class="plain">\</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>139</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">scratchpad[0]=0x00ff&amp;sum;\</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>140</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">scratchpad[1]=0x00ff&amp;(sum&gt;&gt;8);\</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>141</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>142</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>143</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>144</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>145</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>146</code></td><td class="content"><code class="preprocessor">#endif // __AVR_ATtiny25__ </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>147</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>148</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>149</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint8_t scratchpad[9]={0x50,0x05,0x0,0x0,0x7f,0xff,0x00,0x10,0x0}; </code><code class="comments">//Initial scratchpad</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>150</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint8_t scrc; </code><code class="comments">//CRC calculation</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>151</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>152</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint8_t cbuf; </code><code class="comments">//Input buffer for a command</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>153</code></td><td class="content"><code class="keyword bold">const</code> <code class="plain">uint8_t owid[8]={0x28, 0xA2, 0xD9, 0x84, 0x00, 0x00, 0x02, 0xEA};&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>154</code></td><td class="content"><code class="comments">//set your own ID <a href="http://www.tm3d.de/index.php/tools/14-crc8-berechnung">http://www.tm3d.de/index.php/tools/14-crc8-berechnung</a></code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>155</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint8_t bitp;&nbsp; </code><code class="comments">//pointer to current Byte</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>156</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint8_t bytep; </code><code class="comments">//pointer to current Bit</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>157</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>158</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint8_t mode; </code><code class="comments">//state</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>159</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint8_t wmode; </code><code class="comments">//if 0 next bit that send the device is&nbsp; 0</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>160</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint8_t actbit; </code><code class="comments">//current</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>161</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint8_t srcount; </code><code class="comments">//counter for search rom</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>162</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>163</code></td><td class="content"><code class="comments">//States / Modes</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>164</code></td><td class="content"><code class="preprocessor">#define OWM_SLEEP 0&nbsp; //Waiting for next reset pulse</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>165</code></td><td class="content"><code class="preprocessor">#define OWM_RESET 1&nbsp; //Reset pulse received </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>166</code></td><td class="content"><code class="preprocessor">#define OWM_PRESENCE 2&nbsp; //sending presence pulse</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>167</code></td><td class="content"><code class="preprocessor">#define OWM_READ_COMMAND 3 //read 8 bit of command</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>168</code></td><td class="content"><code class="preprocessor">#define OWM_SEARCH_ROM 4&nbsp; //SEARCH_ROM algorithms</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>169</code></td><td class="content"><code class="preprocessor">#define OWM_MATCH_ROM 5&nbsp; //test number</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>170</code></td><td class="content"><code class="preprocessor">#define OWM_READ_SCRATCHPAD 6&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>171</code></td><td class="content"><code class="preprocessor">#define OWM_WRITE_SCRATCHPAD 7</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>172</code></td><td class="content"><code class="preprocessor">#define OWM_CHK_RESET 8&nbsp; //waiting of rising edge from reset pulse</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>173</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>174</code></td><td class="content"><code class="comments">//Write a bit after next falling edge from master</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>175</code></td><td class="content"><code class="comments">//its for sending a zero as soon as possible </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>176</code></td><td class="content"><code class="preprocessor">#define OWW_NO_WRITE 2</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>177</code></td><td class="content"><code class="preprocessor">#define OWW_WRITE_1 1</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>178</code></td><td class="content"><code class="preprocessor">#define OWW_WRITE_0 0</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>179</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>180</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>181</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>182</code></td><td class="content"><code class="plain">PIN_INT {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>183</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t lwmode=wmode;&nbsp; </code><code class="comments">//let this variables in registers</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>184</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t lmode=mode;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>185</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">((lwmode==OWW_WRITE_0)) {SET_LOW;lwmode=OWW_NO_WRITE;}&nbsp;&nbsp;&nbsp; </code><code class="comments">//if necessary set 0-Bit </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>186</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">DIS_OWINT; </code><code class="comments">//disable interrupt, only in OWM_SLEEP mode it is active</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>187</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">switch</code> <code class="plain">(lmode) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>188</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_SLEEP:&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>189</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCNT_REG=~(OWT_MIN_RESET);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>190</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">EN_OWINT; </code><code class="comments">//other edges ?</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>191</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>192</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//start of reading with falling edge from master, reading closed in timer isr</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>193</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_MATCH_ROM:&nbsp; </code><code class="comments">//falling edge wait for receive </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>194</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_WRITE_SCRATCHPAD:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>195</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_READ_COMMAND:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>196</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCNT_REG=~(OWT_READLINE); </code><code class="comments">//wait a time for reading</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>197</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>198</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_SEARCH_ROM:&nbsp;&nbsp; </code><code class="comments">//Search algorithm waiting for receive or send</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>199</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(srcount&lt;2) { </code><code class="comments">//this means bit or complement is writing, </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>200</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCNT_REG=~(OWT_LOWTIME);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>201</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword bold">else</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>202</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCNT_REG=~(OWT_READLINE);&nbsp; </code><code class="comments">//init for read answer of master </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>203</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>204</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_READ_SCRATCHPAD:&nbsp; </code><code class="comments">//a bit is sending </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>205</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCNT_REG=~(OWT_LOWTIME);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>206</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>207</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_CHK_RESET:&nbsp; </code><code class="comments">//rising edge of reset pulse</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>208</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SET_FALLING; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>209</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCNT_REG=~(OWT_RESET_PRESENCE);&nbsp; </code><code class="comments">//waiting for sending presence pulse</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>210</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_RESET;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>211</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>212</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>213</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">EN_TIMER;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>214</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">mode=lmode;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>215</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">wmode=lwmode;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>216</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>217</code></td><td class="content"><code class="plain">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>218</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>219</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>220</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>221</code></td><td class="content"><code class="plain">TIMER_INT {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>222</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t lwmode=wmode; </code><code class="comments">//let this variables in registers</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>223</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t lmode=mode;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>224</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t lbytep=bytep;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>225</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t lbitp=bitp;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>226</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t lsrcount=srcount;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>227</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t lactbit=actbit;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>228</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t lscrc=scrc;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>229</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//Ask input line sate </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>230</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t p=((OW_PIN&amp;OW_PINN)==OW_PINN);&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>231</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//Interrupt still active ?</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>232</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(CHK_INT_EN) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>233</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//maybe reset pulse</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>234</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(p==0) { </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>235</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_CHK_RESET;&nbsp; </code><code class="comments">//wait for rising edge</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>236</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SET_RISING; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>237</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>238</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">DIS_TIMER;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>239</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword bold">else</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>240</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">switch</code> <code class="plain">(lmode) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>241</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_RESET:&nbsp; </code><code class="comments">//Reset pulse and time after is finished, now go in presence state</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>242</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_PRESENCE;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>243</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SET_LOW;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>244</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCNT_REG=~(OWT_PRESENCE);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>245</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">DIS_OWINT;&nbsp; </code><code class="comments">//No Pin interrupt necessary only wait for presence is done</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>246</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>247</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_PRESENCE:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>248</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">RESET_LOW;&nbsp; </code><code class="comments">//Presence is done now wait for a command</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>249</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_READ_COMMAND;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>250</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">cbuf=0;lbitp=1;&nbsp; </code><code class="comments">//Command buffer have to set zero, only set bits will write in</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>251</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>252</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_READ_COMMAND:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>253</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(p) {&nbsp; </code><code class="comments">//Set bit if line high </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>254</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">cbuf|=lbitp;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>255</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>256</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=(lbitp&lt;&lt;1);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>257</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(!lbitp) { </code><code class="comments">//8-Bits read</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>258</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>259</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">switch</code> <code class="plain">(cbuf) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>260</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">0x55:lbytep=0;lmode=OWM_MATCH_ROM;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>261</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">0xF0:&nbsp; </code><code class="comments">//initialize search rom</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>262</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_SEARCH_ROM;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>263</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lsrcount=0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>264</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbytep=0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>265</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lactbit=(owid[lbytep]&amp;lbitp)==lbitp; </code><code class="comments">//set actual bit</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>266</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lwmode=lactbit;&nbsp; </code><code class="comments">//prepare for writing when next falling edge</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>267</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>268</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">0x4E:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>269</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_WRITE_SCRATCHPAD;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>270</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbytep=2;scratchpad[2]=0;&nbsp; </code><code class="comments">//initialize writing position in scratch pad </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>271</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>272</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">0x44:&nbsp; </code><code class="comments">//Start Convert </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>273</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">0x64:&nbsp; </code><code class="comments">// some tool uses this command</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>274</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">CONV_TEMP;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>275</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_SLEEP;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>276</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>277</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">0xBE:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>278</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_READ_SCRATCHPAD; </code><code class="comments">//read scratch pad </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>279</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbytep=0;lscrc=0; </code><code class="comments">//from first position</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>280</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lactbit=(lbitp&amp;scratchpad[0])==lbitp;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>281</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lwmode=lactbit; </code><code class="comments">//prepare for send firs bit </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>282</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>283</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">default</code><code class="plain">: lmode=OWM_SLEEP;&nbsp; </code><code class="comments">//all other commands do nothing</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>284</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>285</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>286</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>287</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_SEARCH_ROM:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>288</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">RESET_LOW;&nbsp; </code><code class="comments">//Set low also if nothing send (branch takes time and memory)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>289</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lsrcount++;&nbsp; </code><code class="comments">//next search rom mode</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>290</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">switch</code> <code class="plain">(lsrcount) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>291</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">1:lwmode=!lactbit;&nbsp; </code><code class="comments">//preparation sending complement</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>292</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>293</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">3:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>294</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(p!=(lactbit==1)) {&nbsp; </code><code class="comments">//check master bit</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>295</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_SLEEP;&nbsp; </code><code class="comments">//not the same go sleep</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>296</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword bold">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>297</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=(lbitp&lt;&lt;1);&nbsp; </code><code class="comments">//prepare next bit</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>298</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(lbitp==0) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>299</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=1;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>300</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbytep++;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>301</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(lbytep&gt;=8) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>302</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_SLEEP;&nbsp; </code><code class="comments">//all bits processed </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>303</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>304</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>305</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>306</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lsrcount=0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>307</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lactbit=(owid[lbytep]&amp;lbitp)==lbitp;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>308</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lwmode=lactbit;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>309</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>310</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>311</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>312</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>313</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_MATCH_ROM:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>314</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(p==((owid[lbytep]&amp;lbitp)==lbitp)) {&nbsp; </code><code class="comments">//Compare with ID Buffer</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>315</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=(lbitp&lt;&lt;1);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>316</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(!lbitp) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>317</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbytep++;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>318</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>319</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(lbytep&gt;=8) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>320</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_READ_COMMAND;&nbsp; </code><code class="comments">//same? get next command</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>321</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>322</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">cbuf=0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>323</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>324</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>325</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>326</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword bold">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>327</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_SLEEP;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>328</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>329</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>330</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_WRITE_SCRATCHPAD:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>331</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(p) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>332</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">scratchpad[lbytep]|=lbitp;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>333</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>334</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=(lbitp&lt;&lt;1);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>335</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(!lbitp) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>336</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbytep++;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>337</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=1;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>338</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(lbytep==5) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>339</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_SLEEP;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>340</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>341</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword bold">else</code> <code class="plain">scratchpad[lbytep]=0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>342</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>343</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>344</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_READ_SCRATCHPAD:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>345</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">RESET_LOW;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>346</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">((lscrc&amp;1)!=lactbit) lscrc=(lscrc&gt;&gt;1)^0x8c; </code><code class="keyword bold">else</code> <code class="plain">lscrc &gt;&gt;=1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>347</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=(lbitp&lt;&lt;1);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>348</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(!lbitp) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>349</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbytep++;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>350</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>351</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(lbytep&gt;=9) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>352</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_SLEEP;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>353</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>354</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword bold">else</code> <code class="keyword bold">if</code> <code class="plain">(lbytep==8) scratchpad[8]=lscrc;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>355</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>356</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lactbit=(lbitp&amp;scratchpad[lbytep])==lbitp;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>357</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lwmode=lactbit;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>358</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>359</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>360</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(lmode==OWM_SLEEP) {DIS_TIMER;}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>361</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(lmode!=OWM_PRESENCE)&nbsp; { </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>362</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCNT_REG=~(OWT_MIN_RESET-OWT_READLINE);&nbsp; </code><code class="comments">//OWT_READLINE around OWT_LOWTIME</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>363</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">EN_OWINT;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>364</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>365</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>366</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">mode=lmode;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>367</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">wmode=lwmode;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>368</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">bytep=lbytep;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>369</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">bitp=lbitp;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>370</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">srcount=lsrcount;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>371</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">actbit=lactbit;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>372</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">scrc=lscrc;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>373</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>374</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>375</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>376</code></td><td class="content"><code class="color1 bold">int</code> <code class="plain">main(</code><code class="keyword bold">void</code><code class="plain">) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>377</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">mode=OWM_SLEEP;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>378</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">wmode=OWW_NO_WRITE;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>379</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">OW_DDR&amp;=~OW_PINN;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>380</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>381</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SET_FALLING;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>382</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>383</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">INIT_AVR</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>384</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">INIT_TEMP</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>385</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">DIS_TIMER;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>386</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>387</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">sei();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>388</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">while</code><code class="plain">(1){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>389</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>390</code></td><td class="content"><code class="plain">}&nbsp;&nbsp; </code></td></tr></tbody></table></div></div></div>
<p>&nbsp;</p>
<p><span>&nbsp;</span></p>
<h2>DS2423 auf ATtiny25 und ATtiny2313</h2>
<p>Durch die 16-Bit CRC Berechnung passt der DS2423 leider nicht mehr 
auf den ATtiny13. Wie man es auch dreht und wendet :-). Hier die 
Variante für den ATtiny25. Der NVRAM ist nicht mit implementiert. Die 
Trigger-Eingänge für die beiden Zähler sind PB3 und PB4. Eine Schaltung 
von <span class="author">p4trykx</span> <span class="author"></span> ist im im <a target="_blank" href="http://comments.gmane.org/gmane.comp.file-systems.owfs.devel/9614">owfs-Forum</a><span> zufinden. Zusätzlich habe ich auch die Anpassung für den ATtiny2313 mit angefügt. Der Code beinhaltet auch die Funktionen <span>Skip</span>-Rom und <span>Read</span>-Rom. Allerdings müssen diese erst in Zeile 180 aktiviert werden.</span></p>
<div class="syntaxhighlighter  " id="highlighter_246625"><div class="bar"><div class="toolbar"><a class="item viewSource" style="width: 16px; height: 16px;" title="Source anzeigen" href="#viewSource">Source anzeigen</a><div class="item copyToClipboard"><embed id="highlighter_246625_clipboard" type="application/x-shockwave-flash" title="in die Zwischenablage kopieren" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_246625" menu="false" src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/clipboard.swf" height="16" width="16"></div><a class="item printSource" style="width: 16px; height: 16px;" title="Drucken" href="#printSource">Drucken</a><a class="item about" style="width: 16px; height: 16px;" title="?" href="#about">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>001</code></td><td class="content"><code class="comments">//owdevice - A small 1-Wire emulator for AVR Microcontroller</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>002</code></td><td class="content"><code class="comments">//</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>003</code></td><td class="content"><code class="comments">//Copyright (C) 2012&nbsp; Tobias Mueller mail (at) tobynet.de</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>004</code></td><td class="content"><code class="comments">//</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>005</code></td><td class="content"><code class="comments">//This program is free software: you can redistribute it and/or modify</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>006</code></td><td class="content"><code class="comments">//it under the terms of the GNU General Public License as published by</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>007</code></td><td class="content"><code class="comments">//the Free Software Foundation, either version 3 of the License, or</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>008</code></td><td class="content"><code class="comments">// any later version.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>009</code></td><td class="content"><code class="comments">//</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>010</code></td><td class="content"><code class="comments">//This program is distributed in the hope that it will be useful,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>011</code></td><td class="content"><code class="comments">//but WITHOUT ANY WARRANTY; without even the implied warranty of</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>012</code></td><td class="content"><code class="comments">//MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&nbsp; See the</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>013</code></td><td class="content"><code class="comments">//GNU General Public License for more details.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>014</code></td><td class="content"><code class="comments">//</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>015</code></td><td class="content"><code class="comments">//You should have received a copy of the GNU General Public License</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>016</code></td><td class="content"><code class="comments">//along with this program.&nbsp; If not, see &lt;<a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>&gt;.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>017</code></td><td class="content"><code class="comments">//</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>018</code></td><td class="content"><code class="comments">//</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>019</code></td><td class="content"><code class="comments">//VERSION 1.2 DS2423&nbsp; for ATTINY2313 and ATTINY25</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>020</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>021</code></td><td class="content"><code class="comments">//FOR MAKE by hand</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>022</code></td><td class="content"><code class="comments">/*</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>023</code></td><td class="content"><code class="comments">avr-gcc -mmcu=[attiny25|attiny2313] -O2 -c ow_slave_DS2423.c</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>024</code></td><td class="content"><code class="comments">avr-gcc.exe -mmcu=[attiny25|attiny2313]&nbsp; ow_slave_DS2423.o -o ow_slave_DS2423.elf</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>025</code></td><td class="content"><code class="comments">avr-objcopy -O ihex&nbsp; ow_slave_DS2423.elf ow_slave_DS2423.hex</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>026</code></td><td class="content"><code class="comments">*/</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>027</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>028</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>029</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>030</code></td><td class="content"><code class="preprocessor">#include &lt;avr/io.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>031</code></td><td class="content"><code class="preprocessor">#include &lt;avr/interrupt.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>032</code></td><td class="content"><code class="comments">//does not work here because less memory by ATtiny13</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>033</code></td><td class="content"><code class="preprocessor">#if defined(__AVR_ATtiny13A__) || defined(__AVR_ATtiny13__)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>034</code></td><td class="content"><code class="comments">// OW_PORT Pin 6&nbsp; - PB1</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>035</code></td><td class="content"><code class="comments">//Analog input PB2</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>036</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>037</code></td><td class="content"><code class="comments">//OW Pin</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>038</code></td><td class="content"><code class="preprocessor">#define OW_PORT PORTB //1 Wire Port</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>039</code></td><td class="content"><code class="preprocessor">#define OW_PIN PINB //1 Wire Pin as number</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>040</code></td><td class="content"><code class="preprocessor">#define OW_PORTN (1&lt;&lt;PINB1)&nbsp; //Pin as bit in registers</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>041</code></td><td class="content"><code class="preprocessor">#define OW_PINN (1&lt;&lt;PINB1)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>042</code></td><td class="content"><code class="preprocessor">#define OW_DDR DDRB&nbsp; //pin direction register</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>043</code></td><td class="content"><code class="preprocessor">#define SET_LOW OW_DDR|=OW_PINN;OW_PORT&amp;=~OW_PORTN;&nbsp; //set 1-Wire line to low</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>044</code></td><td class="content"><code class="preprocessor">#define RESET_LOW {OW_DDR&amp;=~OW_PINN;}&nbsp; //set 1-Wire pin as input</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>045</code></td><td class="content"><code class="comments">//Pin interrupt </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>046</code></td><td class="content"><code class="preprocessor">#define EN_OWINT {GIMSK|=(1&lt;&lt;INT0);GIFR|=(1&lt;&lt;INTF0);}&nbsp; //enable interrupt </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>047</code></td><td class="content"><code class="preprocessor">#define DIS_OWINT&nbsp; GIMSK&amp;=~(1&lt;&lt;INT0);&nbsp; //disable interrupt</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>048</code></td><td class="content"><code class="preprocessor">#define SET_RISING MCUCR=(1&lt;&lt;ISC01)|(1&lt;&lt;ISC00);&nbsp; //set interrupt at rising edge</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>049</code></td><td class="content"><code class="preprocessor">#define SET_FALLING MCUCR=(1&lt;&lt;ISC01); //set interrupt at falling edge</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>050</code></td><td class="content"><code class="preprocessor">#define CHK_INT_EN (GIMSK&amp;(1&lt;&lt;INT0))==(1&lt;&lt;INT0) //test if interrupt enabled</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>051</code></td><td class="content"><code class="preprocessor">#define PIN_INT ISR(INT0_vect)&nbsp; // the interrupt service routine</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>052</code></td><td class="content"><code class="comments">//Timer Interrupt</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>053</code></td><td class="content"><code class="preprocessor">#define EN_TIMER {TIMSK0 |= (1&lt;&lt;TOIE0); TIFR0|=(1&lt;&lt;TOV0);} //enable timer interrupt</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>054</code></td><td class="content"><code class="preprocessor">#define DIS_TIMER TIMSK0&nbsp; &amp;= ~(1&lt;&lt;TOIE0); // disable timer interrupt</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>055</code></td><td class="content"><code class="preprocessor">#define TCNT_REG TCNT0&nbsp; //register of timer-counter</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>056</code></td><td class="content"><code class="preprocessor">#define TIMER_INT ISR(TIM0_OVF_vect) //the timer interrupt service routine</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>057</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>058</code></td><td class="content"><code class="comments">//Initializations of AVR</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>059</code></td><td class="content"><code class="preprocessor">#define INIT_AVR CLKPR=(1&lt;&lt;CLKPCE);\</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>060</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">CLKPR=0;</code><code class="comments">/*9.6Mhz*/</code><code class="plain">\</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>061</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TIMSK0=0;\</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>062</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">GIMSK=(1&lt;&lt;INT0);</code><code class="comments">/*set direct GIMSK register*/</code><code class="plain">\</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>063</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCCR0B=(1&lt;&lt;CS00)|(1&lt;&lt;CS01); </code><code class="comments">/*9.6mhz /64 couse 8 bit Timer interrupt every 6,666us*/</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>064</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>065</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>066</code></td><td class="content"><code class="comments">//Times</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>067</code></td><td class="content"><code class="preprocessor">#define OWT_MIN_RESET 51 //minimum duration of the Reset impulse</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>068</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>069</code></td><td class="content"><code class="preprocessor">#define OWT_RESET_PRESENCE 4 //time between rising edge of reset impulse and presence impulse</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>070</code></td><td class="content"><code class="preprocessor">#define OWT_PRESENCE 20 //duration of the presence impulse</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>071</code></td><td class="content"><code class="preprocessor">#define OWT_READLINE 4&nbsp; //duration from master low to read the state of 1-Wire line</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>072</code></td><td class="content"><code class="preprocessor">#define OWT_LOWTIME 4 //length of low </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>073</code></td><td class="content"><code class="preprocessor">#endif</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>074</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>075</code></td><td class="content"><code class="preprocessor">#ifdef __AVR_ATtiny25__ </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>076</code></td><td class="content"><code class="comments">// OW_PORT Pin 7&nbsp; - PB2</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>077</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>078</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>079</code></td><td class="content"><code class="comments">//OW Pin</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>080</code></td><td class="content"><code class="preprocessor">#define OW_PORT PORTB //1 Wire Port</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>081</code></td><td class="content"><code class="preprocessor">#define OW_PIN PINB //1 Wire Pin as number</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>082</code></td><td class="content"><code class="preprocessor">#define OW_PORTN (1&lt;&lt;PINB2)&nbsp; //Pin as bit in registers</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>083</code></td><td class="content"><code class="preprocessor">#define OW_PINN (1&lt;&lt;PINB2)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>084</code></td><td class="content"><code class="preprocessor">#define OW_DDR DDRB&nbsp; //pin direction register</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>085</code></td><td class="content"><code class="preprocessor">#define SET_LOW OW_DDR|=OW_PINN;OW_PORT&amp;=~OW_PORTN;&nbsp; //set 1-Wire line to low</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>086</code></td><td class="content"><code class="preprocessor">#define RESET_LOW {OW_DDR&amp;=~OW_PINN;}&nbsp; //set 1-Wire pin as input</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>087</code></td><td class="content"><code class="comments">//Pin interrupt </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>088</code></td><td class="content"><code class="preprocessor">#define EN_OWINT {GIMSK|=(1&lt;&lt;INT0);GIFR|=(1&lt;&lt;INTF0);}&nbsp; //enable interrupt </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>089</code></td><td class="content"><code class="preprocessor">#define DIS_OWINT&nbsp; GIMSK&amp;=~(1&lt;&lt;INT0);&nbsp; //disable interrupt</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>090</code></td><td class="content"><code class="preprocessor">#define SET_RISING MCUCR=(1&lt;&lt;ISC01)|(1&lt;&lt;ISC00);&nbsp; //set interrupt at rising edge</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>091</code></td><td class="content"><code class="preprocessor">#define SET_FALLING MCUCR=(1&lt;&lt;ISC01); //set interrupt at falling edge</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>092</code></td><td class="content"><code class="preprocessor">#define CHK_INT_EN (GIMSK&amp;(1&lt;&lt;INT0))==(1&lt;&lt;INT0) //test if interrupt enabled</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>093</code></td><td class="content"><code class="preprocessor">#define PIN_INT ISR(INT0_vect)&nbsp; // the interrupt service routine</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>094</code></td><td class="content"><code class="comments">//Timer Interrupt</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>095</code></td><td class="content"><code class="preprocessor">#define EN_TIMER {TIMSK |= (1&lt;&lt;TOIE0); TIFR|=(1&lt;&lt;TOV0);} //enable timer interrupt</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>096</code></td><td class="content"><code class="preprocessor">#define DIS_TIMER TIMSK&nbsp; &amp;= ~(1&lt;&lt;TOIE0); // disable timer interrupt</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>097</code></td><td class="content"><code class="preprocessor">#define TCNT_REG TCNT0&nbsp; //register of timer-counter</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>098</code></td><td class="content"><code class="preprocessor">#define TIMER_INT ISR(TIM0_OVF_vect) //the timer interrupt service routine</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>099</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>100</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>101</code></td><td class="content"><code class="preprocessor">#define OWT_MIN_RESET 51</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>102</code></td><td class="content"><code class="preprocessor">#define OWT_RESET_PRESENCE 4</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>103</code></td><td class="content"><code class="preprocessor">#define OWT_PRESENCE 20 </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>104</code></td><td class="content"><code class="preprocessor">#define OWT_READLINE 3 //for fast master, 4 for slow master and long lines</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>105</code></td><td class="content"><code class="preprocessor">#define OWT_LOWTIME 3 //for fast master, 4 for slow master and long lines</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>106</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>107</code></td><td class="content"><code class="comments">//Initializations of AVR</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>108</code></td><td class="content"><code class="preprocessor">#define INIT_AVR CLKPR=(1&lt;&lt;CLKPCE); \</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>109</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">CLKPR=0; </code><code class="comments">/*8Mhz*/</code>&nbsp; <code class="plain">\</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>110</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TIMSK=0; \</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>111</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">GIMSK=(1&lt;&lt;INT0);&nbsp; </code><code class="comments">/*set direct GIMSK register*/</code> <code class="plain">\</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>112</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCCR0B=(1&lt;&lt;CS00)|(1&lt;&lt;CS01); </code><code class="comments">/*8mhz /64 couse 8 bit Timer interrupt every 8us*/</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>113</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>114</code></td><td class="content"><code class="preprocessor">#define PC_INT_ISR ISR(PCINT0_vect) { /*ATT25 with 0 by PCINT*/ \</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>115</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(((PINB&amp;(1&lt;&lt;PINB3))==0)&amp;&amp;((istat&amp;(1&lt;&lt;PINB3))==(1&lt;&lt;PINB3)))
 {&nbsp;&nbsp; Counter0++; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>116</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(((PINB&amp;(1&lt;&lt;PINB4))==0)&amp;&amp;((istat&amp;(1&lt;&lt;PINB4))==(1&lt;&lt;PINB4)))
 {&nbsp;&nbsp; Counter1++; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>117</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">istat=PINB;}&nbsp;&nbsp;&nbsp; \</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>118</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>119</code></td><td class="content"><code class="preprocessor">#define INIT_COUNTER_PINS /* Counter Interrupt */\</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>120</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">GIMSK|=(1&lt;&lt;PCIE);\</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>121</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">PCMSK=(1&lt;&lt;PCINT3)|(1&lt;&lt;PCINT4);&nbsp; \</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>122</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">DDRB &amp;=~((1&lt;&lt;PINB3)|(1&lt;&lt;PINB4)); \</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>123</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">istat=PINB;\</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>124</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>125</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>126</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>127</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>128</code></td><td class="content"><code class="preprocessor">#endif // __AVR_ATtiny25__ </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>129</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>130</code></td><td class="content"><code class="preprocessor">#if defined(__AVR_ATtiny2313A__) || defined(__AVR_ATtiny2313__)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>131</code></td><td class="content"><code class="comments">// OW_PORT Pin 6&nbsp; - PD2</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>132</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>133</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>134</code></td><td class="content"><code class="comments">//OW Pin</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>135</code></td><td class="content"><code class="preprocessor">#define OW_PORT PORTD //1 Wire Port</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>136</code></td><td class="content"><code class="preprocessor">#define OW_PIN PIND //1 Wire Pin as number</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>137</code></td><td class="content"><code class="preprocessor">#define OW_PORTN (1&lt;&lt;PIND2)&nbsp; //Pin as bit in registers</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>138</code></td><td class="content"><code class="preprocessor">#define OW_PINN (1&lt;&lt;PIND2)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>139</code></td><td class="content"><code class="preprocessor">#define OW_DDR DDRD&nbsp; //pin direction register</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>140</code></td><td class="content"><code class="preprocessor">#define SET_LOW OW_DDR|=OW_PINN;OW_PORT&amp;=~OW_PORTN;&nbsp; //set 1-Wire line to low</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>141</code></td><td class="content"><code class="preprocessor">#define RESET_LOW {OW_DDR&amp;=~OW_PINN;}&nbsp; //set 1-Wire pin as input</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>142</code></td><td class="content"><code class="comments">//Pin interrupt </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>143</code></td><td class="content"><code class="preprocessor">#define EN_OWINT {GIMSK|=(1&lt;&lt;INT0);EIFR|=(1&lt;&lt;INTF0);}&nbsp; //enable interrupt </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>144</code></td><td class="content"><code class="preprocessor">#define DIS_OWINT&nbsp; GIMSK&amp;=~(1&lt;&lt;INT0);&nbsp; //disable interrupt</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>145</code></td><td class="content"><code class="preprocessor">#define SET_RISING MCUCR|=(1&lt;&lt;ISC01)|(1&lt;&lt;ISC00);&nbsp; //set interrupt at rising edge</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>146</code></td><td class="content"><code class="preprocessor">#define SET_FALLING {MCUCR|=(1&lt;&lt;ISC01);MCUCR&amp;=~(1&lt;&lt;ISC00);} //set interrupt at falling edge</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>147</code></td><td class="content"><code class="preprocessor">#define CHK_INT_EN (GIMSK&amp;(1&lt;&lt;INT0))==(1&lt;&lt;INT0) //test if interrupt enabled</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>148</code></td><td class="content"><code class="preprocessor">#define PIN_INT ISR(INT0_vect)&nbsp; // the interrupt service routine</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>149</code></td><td class="content"><code class="comments">//Timer Interrupt</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>150</code></td><td class="content"><code class="preprocessor">#define EN_TIMER {TIMSK |= (1&lt;&lt;TOIE0); TIFR|=(1&lt;&lt;TOV0);} //enable timer interrupt</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>151</code></td><td class="content"><code class="preprocessor">#define DIS_TIMER TIMSK&nbsp; &amp;= ~(1&lt;&lt;TOIE0); // disable timer interrupt</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>152</code></td><td class="content"><code class="preprocessor">#define TCNT_REG TCNT0&nbsp; //register of timer-counter</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>153</code></td><td class="content"><code class="preprocessor">#define TIMER_INT ISR(TIMER0_OVF_vect) //the timer interrupt service routine</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>154</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>155</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>156</code></td><td class="content"><code class="preprocessor">#define OWT_MIN_RESET 51</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>157</code></td><td class="content"><code class="preprocessor">#define OWT_RESET_PRESENCE 4</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>158</code></td><td class="content"><code class="preprocessor">#define OWT_PRESENCE 20 </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>159</code></td><td class="content"><code class="preprocessor">#define OWT_READLINE 3 //for fast master, 4 for slow master and long lines</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>160</code></td><td class="content"><code class="preprocessor">#define OWT_LOWTIME 3 //for fast master, 4 for slow master and long lines</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>161</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>162</code></td><td class="content"><code class="comments">//Initializations of AVR</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>163</code></td><td class="content"><code class="preprocessor">#define INIT_AVR CLKPR=(1&lt;&lt;CLKPCE); \</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>164</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">CLKPR=0; </code><code class="comments">/*8Mhz*/</code>&nbsp; <code class="plain">\</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>165</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TIMSK=0; \</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>166</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">GIMSK=(1&lt;&lt;INT0);&nbsp; </code><code class="comments">/*set direct GIMSK register*/</code> <code class="plain">\</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>167</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCCR0B=(1&lt;&lt;CS00)|(1&lt;&lt;CS01); </code><code class="comments">/*8mhz /64 couse 8 bit Timer interrupt every 8us*/</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>168</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>169</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>170</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>171</code></td><td class="content"><code class="preprocessor">#define PC_INT_ISR ISR(PCINT_vect) { /*ATT2313 without 0 by PCINT*/ \</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>172</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(((PINB&amp;(1&lt;&lt;PINB3))==0)&amp;&amp;((istat&amp;(1&lt;&lt;PINB3))==(1&lt;&lt;PINB3)))
 {&nbsp;&nbsp; Counter0++; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>173</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(((PINB&amp;(1&lt;&lt;PINB4))==0)&amp;&amp;((istat&amp;(1&lt;&lt;PINB4))==(1&lt;&lt;PINB4)))
 {&nbsp;&nbsp; Counter1++; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>174</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">istat=PINB;}&nbsp;&nbsp;&nbsp; \</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>175</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>176</code></td><td class="content"><code class="preprocessor">#define INIT_COUNTER_PINS /* Counter Interrupt */\</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>177</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">GIMSK|=(1&lt;&lt;PCIE);\</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>178</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">PCMSK=(1&lt;&lt;PCINT3)|(1&lt;&lt;PCINT4);&nbsp; \</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>179</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">DDRB &amp;=~((1&lt;&lt;PINB3)|(1&lt;&lt;PINB4)); \</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>180</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">istat=PINB;\</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>181</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>182</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>183</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>184</code></td><td class="content"><code class="preprocessor">#endif // __AVR_ATtiny2313__ </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>185</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>186</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>187</code></td><td class="content"><code class="comments">//#define _ONE_DEVICE_CMDS_&nbsp; //Commands for only one device on bus (Not tested)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>188</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>189</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>190</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>191</code></td><td class="content"><code class="keyword bold">typedef</code> <code class="keyword bold">union</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>192</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">volatile</code> <code class="plain">uint8_t bytes[13];</code><code class="comments">//={1,1,2,0,0,0,0,0,0,0,0,5,5};</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>193</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">struct</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>194</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint16_t addr;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>195</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t read;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>196</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint32_t counter;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>197</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint32_t zero;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>198</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint16_t crc;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>199</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">};</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>200</code></td><td class="content"><code class="plain">} counterpack_t;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>201</code></td><td class="content"><code class="plain">counterpack_t counterpack;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>202</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint16_t scrc; </code><code class="comments">//CRC calculation</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>203</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>204</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint8_t lastcps;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>205</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint32_t Counter0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>206</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint32_t Counter1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>207</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint8_t istat;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>208</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>209</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>210</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint8_t cbuf; </code><code class="comments">//Input buffer for a command</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>211</code></td><td class="content"><code class="keyword bold">const</code> <code class="plain">uint8_t owid[8]={0x1D, 0xA2, 0xD9, 0x84, 0x00, 0x00, 0x02, 0x37};&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>212</code></td><td class="content"><code class="comments">//set your own ID <a href="http://www.tm3d.de/index.php/tools/14-crc8-berechnung">http://www.tm3d.de/index.php/tools/14-crc8-berechnung</a></code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>213</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint8_t bitp;&nbsp; </code><code class="comments">//pointer to current Byte</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>214</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint8_t bytep; </code><code class="comments">//pointer to current Bit</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>215</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>216</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint8_t mode; </code><code class="comments">//state</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>217</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint8_t wmode; </code><code class="comments">//if 0 next bit that send the device is&nbsp; 0</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>218</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint8_t actbit; </code><code class="comments">//current</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>219</code></td><td class="content"><code class="keyword bold">volatile</code> <code class="plain">uint8_t srcount; </code><code class="comments">//counter for search rom</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>220</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>221</code></td><td class="content"><code class="comments">//States / Modes</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>222</code></td><td class="content"><code class="preprocessor">#define OWM_SLEEP 0&nbsp; //Waiting for next reset pulse</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>223</code></td><td class="content"><code class="preprocessor">#define OWM_RESET 1&nbsp; //Reset pulse received </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>224</code></td><td class="content"><code class="preprocessor">#define OWM_PRESENCE 2&nbsp; //sending presence pulse</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>225</code></td><td class="content"><code class="preprocessor">#define OWM_READ_COMMAND 3 //read 8 bit of command</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>226</code></td><td class="content"><code class="preprocessor">#define OWM_SEARCH_ROM 4&nbsp; //SEARCH_ROM algorithms</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>227</code></td><td class="content"><code class="preprocessor">#define OWM_MATCH_ROM 5&nbsp; //test number</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>228</code></td><td class="content"><code class="preprocessor">#define OWM_CHK_RESET 8&nbsp; //waiting of rising edge from reset pulse</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>229</code></td><td class="content"><code class="preprocessor">#define OWM_GET_ADRESS 6</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>230</code></td><td class="content"><code class="preprocessor">#define OWM_READ_MEMORY_COUNTER 7</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>231</code></td><td class="content"><code class="preprocessor">#define OWM_WRITE_SCRATCHPAD 9</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>232</code></td><td class="content"><code class="preprocessor">#define OWM_READ_SCRATCHPAD 10</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>233</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>234</code></td><td class="content"><code class="preprocessor">#ifdef _ONE_DEVICE_CMDS_</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>235</code></td><td class="content"><code class="preprocessor">#define OWM_READ_ROM 50</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>236</code></td><td class="content"><code class="preprocessor">#endif</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>237</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>238</code></td><td class="content"><code class="comments">//Write a bit after next falling edge from master</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>239</code></td><td class="content"><code class="comments">//its for sending a zero as soon as possible </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>240</code></td><td class="content"><code class="preprocessor">#define OWW_NO_WRITE 2</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>241</code></td><td class="content"><code class="preprocessor">#define OWW_WRITE_1 1</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>242</code></td><td class="content"><code class="preprocessor">#define OWW_WRITE_0 0</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>243</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>244</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>245</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>246</code></td><td class="content"><code class="plain">PIN_INT {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>247</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t lwmode=wmode;&nbsp; </code><code class="comments">//let this variables in registers</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>248</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t lmode=mode;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>249</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">((lwmode==OWW_WRITE_0)) {SET_LOW;lwmode=OWW_NO_WRITE;}&nbsp;&nbsp;&nbsp; </code><code class="comments">//if necessary set 0-Bit </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>250</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">DIS_OWINT; </code><code class="comments">//disable interrupt, only in OWM_SLEEP mode it is active</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>251</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">switch</code> <code class="plain">(lmode) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>252</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_SLEEP:&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>253</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCNT_REG=~(OWT_MIN_RESET);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>254</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">EN_OWINT; </code><code class="comments">//other edges ?</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>255</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>256</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//start of reading with falling edge from master, reading closed in timer isr</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>257</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_MATCH_ROM:&nbsp; </code><code class="comments">//falling edge wait for receive </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>258</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_GET_ADRESS:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>259</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_READ_COMMAND:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>260</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCNT_REG=~(OWT_READLINE); </code><code class="comments">//wait a time for reading</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>261</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>262</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_SEARCH_ROM:&nbsp;&nbsp; </code><code class="comments">//Search algorithm waiting for receive or send</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>263</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(srcount&lt;2) { </code><code class="comments">//this means bit or complement is writing, </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>264</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCNT_REG=~(OWT_LOWTIME);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>265</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword bold">else</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>266</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCNT_REG=~(OWT_READLINE);&nbsp; </code><code class="comments">//init for read answer of master </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>267</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>268</code></td><td class="content"><code class="preprocessor">#ifdef _ONE_DEVICE_CMDS_</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>269</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_READ_ROM:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>270</code></td><td class="content"><code class="preprocessor">#endif&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>271</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_READ_MEMORY_COUNTER: </code><code class="comments">//a bit is sending </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>272</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCNT_REG=~(OWT_LOWTIME);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>273</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>274</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_CHK_RESET:&nbsp; </code><code class="comments">//rising edge of reset pulse</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>275</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SET_FALLING; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>276</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCNT_REG=~(OWT_RESET_PRESENCE);&nbsp; </code><code class="comments">//waiting for sending presence pulse</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>277</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_RESET;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>278</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>279</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>280</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">EN_TIMER;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>281</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">mode=lmode;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>282</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">wmode=lwmode;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>283</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>284</code></td><td class="content"><code class="plain">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>285</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>286</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>287</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>288</code></td><td class="content"><code class="plain">TIMER_INT {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>289</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t lwmode=wmode; </code><code class="comments">//let this variables in registers</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>290</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t lmode=mode;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>291</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t lbytep=bytep;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>292</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t lbitp=bitp;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>293</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t lsrcount=srcount;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>294</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t lactbit=actbit;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>295</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint16_t lscrc=scrc;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>296</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//Ask input line sate </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>297</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t p=((OW_PIN&amp;OW_PINN)==OW_PINN);&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>298</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//Interrupt still active ?</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>299</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(CHK_INT_EN) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>300</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//maybe reset pulse</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>301</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(p==0) { </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>302</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_CHK_RESET;&nbsp; </code><code class="comments">//wait for rising edge</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>303</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SET_RISING; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>304</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>305</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">DIS_TIMER;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>306</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword bold">else</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>307</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">switch</code> <code class="plain">(lmode) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>308</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_RESET:&nbsp; </code><code class="comments">//Reset pulse and time after is finished, now go in presence state</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>309</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_PRESENCE;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>310</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SET_LOW;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>311</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCNT_REG=~(OWT_PRESENCE);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>312</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">DIS_OWINT;&nbsp; </code><code class="comments">//No Pin interrupt necessary only wait for presence is done</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>313</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>314</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_PRESENCE:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>315</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">RESET_LOW;&nbsp; </code><code class="comments">//Presence is done now wait for a command</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>316</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_READ_COMMAND;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>317</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">cbuf=0;lbitp=1;&nbsp; </code><code class="comments">//Command buffer have to set zero, only set bits will write in</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>318</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>319</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_READ_COMMAND:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>320</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(p) {&nbsp; </code><code class="comments">//Set bit if line high </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>321</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">cbuf|=lbitp;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>322</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>323</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=(lbitp&lt;&lt;1);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>324</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(!lbitp) { </code><code class="comments">//8-Bits read</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>325</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=1;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>326</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">switch</code> <code class="plain">(cbuf) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>327</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">0x55:lbytep=0;lmode=OWM_MATCH_ROM;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>328</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">0xF0:&nbsp; </code><code class="comments">//initialize search rom</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>329</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_SEARCH_ROM;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>330</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lsrcount=0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>331</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbytep=0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>332</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lactbit=(owid[lbytep]&amp;lbitp)==lbitp; </code><code class="comments">//set actual bit</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>333</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lwmode=lactbit;&nbsp; </code><code class="comments">//prepare for writing when next falling edge</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>334</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>335</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">0xA5:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>336</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_GET_ADRESS; </code><code class="comments">//first the master send an address </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>337</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbytep=0;lscrc=0x7bc0; </code><code class="comments">//CRC16 of 0xA5</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>338</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">counterpack.bytes[0]=0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>339</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>340</code></td><td class="content"><code class="preprocessor">#ifdef _ONE_DEVICE_CMDS_</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>341</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">0xCC:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>342</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbytep=0;cbuf=0;lmode=OWM_READ_COMMAND;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>343</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">0x33:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>344</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_READ_ROM;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>345</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbytep=0;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>346</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>347</code></td><td class="content"><code class="preprocessor">#endif&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>348</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">default</code><code class="plain">: lmode=OWM_SLEEP;&nbsp; </code><code class="comments">//all other commands do nothing</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>349</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>350</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>351</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>352</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_SEARCH_ROM:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>353</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">RESET_LOW;&nbsp; </code><code class="comments">//Set low also if nothing send (branch takes time and memory)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>354</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lsrcount++;&nbsp; </code><code class="comments">//next search rom mode</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>355</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">switch</code> <code class="plain">(lsrcount) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>356</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">1:lwmode=!lactbit;&nbsp; </code><code class="comments">//preparation sending complement</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>357</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>358</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">3:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>359</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(p!=(lactbit==1)) {&nbsp; </code><code class="comments">//check master bit</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>360</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_SLEEP;&nbsp; </code><code class="comments">//not the same go sleep</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>361</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword bold">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>362</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=(lbitp&lt;&lt;1);&nbsp; </code><code class="comments">//prepare next bit</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>363</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(lbitp==0) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>364</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>365</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbytep++;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>366</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(lbytep&gt;=8) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>367</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_SLEEP;&nbsp; </code><code class="comments">//all bits processed </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>368</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>369</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>370</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>371</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lsrcount=0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>372</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lactbit=(owid[lbytep]&amp;lbitp)==lbitp;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>373</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lwmode=lactbit;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>374</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>375</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>376</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>377</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>378</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_MATCH_ROM:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>379</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(p==((owid[lbytep]&amp;lbitp)==lbitp)) {&nbsp; </code><code class="comments">//Compare with ID Buffer</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>380</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=(lbitp&lt;&lt;1);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>381</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(!lbitp) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>382</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbytep++;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>383</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=1;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>384</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(lbytep&gt;=8) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>385</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_READ_COMMAND;&nbsp; </code><code class="comments">//same? get next command</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>386</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>387</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">cbuf=0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>388</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>389</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>390</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>391</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword bold">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>392</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_SLEEP;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>393</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>394</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>395</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_GET_ADRESS:&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>396</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(p) { </code><code class="comments">//Get the Address for reading</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>397</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">counterpack.bytes[lbytep]|=lbitp;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>398</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>399</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//address is part of crc</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>400</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">((lscrc&amp;1)!=p) lscrc=(lscrc&gt;&gt;1)^0xA001; </code><code class="keyword bold">else</code> <code class="plain">lscrc &gt;&gt;=1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>401</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=(lbitp&lt;&lt;1);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>402</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(!lbitp) {&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>403</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbytep++;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>404</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>405</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(lbytep==2) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>406</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_READ_MEMORY_COUNTER;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>407</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lactbit=(lbitp&amp;counterpack.bytes[lbytep])==lbitp;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>408</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lwmode=lactbit;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>409</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lsrcount=(counterpack.addr&amp;0xfe0)+0x20-counterpack.addr; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>410</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//bytes between start and Counter Values, Iam never understanding why so much???</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>411</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>412</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword bold">else</code> <code class="plain">counterpack.bytes[lbytep]=0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>413</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>414</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>415</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_READ_MEMORY_COUNTER:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>416</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">RESET_LOW;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>417</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//CRC16 Calculation</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>418</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">((lscrc&amp;1)!=lactbit) lscrc=(lscrc&gt;&gt;1)^0xA001; </code><code class="keyword bold">else</code> <code class="plain">lscrc &gt;&gt;=1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>419</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">p=lactbit;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>420</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=(lbitp&lt;&lt;1);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>421</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(!lbitp) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>422</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbytep++;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>423</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=1;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>424</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(lbytep==3) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>425</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lsrcount--;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>426</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(lsrcount) lbytep--;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>427</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">else</code>&nbsp; <code class="plain">{</code><code class="comments">//now copy counter in send buffer</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>428</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">switch</code> <code class="plain">(counterpack.addr&amp;0xFe0) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>429</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">0x1E0:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>430</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">counterpack.counter=Counter0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>431</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>432</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">0x1C0:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>433</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">counterpack.counter=Counter1;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>434</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>435</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">default</code><code class="plain">: counterpack.counter=0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>436</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>437</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>438</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>439</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(lbytep&gt;=13) { </code><code class="comments">//done sending</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>440</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_SLEEP;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>441</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>442</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>443</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">((lbytep==11)&amp;&amp;(lbitp==1)) { </code><code class="comments">//Send CRC</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>444</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">counterpack.crc=~lscrc; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>445</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>446</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>447</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>448</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lactbit=(lbitp&amp;counterpack.bytes[lbytep])==lbitp;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>449</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lwmode=lactbit;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>450</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>451</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>452</code></td><td class="content"><code class="preprocessor">#ifdef _ONE_DEVICE_CMDS_&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>453</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">OWM_READ_ROM:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>454</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">RESET_LOW;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>455</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=(lbitp&lt;&lt;1);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>456</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(!lbitp) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>457</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbytep++;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>458</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lbitp=1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>459</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(lbytep&gt;=8) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>460</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lmode=OWM_SLEEP;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>461</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>462</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>463</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>464</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lactbit=(lbitp&amp;owid[lbytep])==lbitp;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>465</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lwmode=lactbit;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>466</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>467</code></td><td class="content"><code class="preprocessor">#endif&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>468</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>469</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(lmode==OWM_SLEEP) {DIS_TIMER;}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>470</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(lmode!=OWM_PRESENCE)&nbsp; { </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>471</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">TCNT_REG=~(OWT_MIN_RESET-OWT_READLINE);&nbsp; </code><code class="comments">//OWT_READLINE around OWT_LOWTIME</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>472</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">EN_OWINT;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>473</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>474</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">mode=lmode;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>475</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">wmode=lwmode;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>476</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">bytep=lbytep;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>477</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">bitp=lbitp;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>478</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">srcount=lsrcount;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>479</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">actbit=lactbit;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>480</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">scrc=lscrc;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>481</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>482</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>483</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>484</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>485</code></td><td class="content"><code class="plain">PC_INT_ISR&nbsp; </code><code class="comments">//for counting&nbsp; defined for specific device</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>486</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>487</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>488</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>489</code></td><td class="content"><code class="color1 bold">int</code> <code class="plain">main(</code><code class="keyword bold">void</code><code class="plain">) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>490</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">mode=OWM_SLEEP;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>491</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">wmode=OWW_NO_WRITE;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>492</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">OW_DDR&amp;=~OW_PINN;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>493</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>494</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">uint8_t i;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>495</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">for</code><code class="plain">(i=0;i&lt;</code><code class="keyword bold">sizeof</code><code class="plain">(counterpack);i++) counterpack.bytes[i]=0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>496</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Counter0=0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>497</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Counter1=0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>498</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>499</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>500</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SET_FALLING;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>501</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>502</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">INIT_AVR</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>503</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">DIS_TIMER;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>504</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>505</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">INIT_COUNTER_PINS</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>506</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>507</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">sei();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>508</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>509</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">while</code><code class="plain">(1){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>510</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>511</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>512</code></td><td class="content"><code class="plain">}&nbsp;&nbsp; </code></td></tr></tbody></table></div></div></div>
<p>Vielen Dank für die netten Kommentare. Ich freue mich immer über Rückmeldungen, Wünsche, Anregungen usw.</p>
<p></p><div class="jcomments-links"> <a class="comments-link" href="http://www.tm3d.de/index.php/1-wire-device-mit-avr/12-avr-owdevice-v12#comments" title="7 Kommentare">7 Kommentare</a> </div>



<div class="item-separator"></div>
	</div>
					<div class="item column-2">
		


	


<h1>Erklärungen zum 1-Wire Emulator</h1>
<p>Einige Erklärungen zum grundsätzlichen Ablauf:</p>
<h3>Reset-Impuls erkennen</h3>
<p>Eine 1-Wire-Sequenz beginnt immer mit einem Reset-Impuls. Dies ist 
der längste Low-Pegel im ganzen Protokoll. Im "Ruhezustand" (OWM_SLEEP) 
wird bei jeder fallenden Flanke ein Interrupt ausgelöst. Gleichzeitig 
wird ein Timer gestartet der nach der angegebenen minimalen Länge des 
Reset-Impulses eine Leitungsanfrage auslöst. Ist die Leitung dann immer 
noch auf Low, so wird der Pegel-Interrupt auf die Detektion einer 
steigenden Flanke umgestellt und sozusagen auf das Ende des 
Reset-Impulses gewartet.</p>
<p>Was passiert, wenn das 1-Wire Device im Ruhezustand ist, weil der 1-Wire Master mit einem anderem Gerät kommuniziert? <br>Jede
 fallende Flanke löst einen Interrupt aus. Der Timer wird immer wieder 
zurückgesetzt, oder am Ende der Kommunikation wird ein High-Pegel 
detektiert.</p>
<p><a class="linkthumb" target="_blank" title="UML des Kommunikationsbeginns" rel="lightbox[id0]" href="http://www.tm3d.de/cache/1/71b4acd0a7115d0b846fa9d04ba39e12.png"><img alt="UML des Kommunikationsbeginns" src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/30908d0cdb6f72d3ca11c8423a913ac9.png" class="thumb" height="455" width="500"></a>&nbsp; <span style="font-size: 8pt;">UML für den Kommunikationsbeginn (<a target="_blank" href="http://www.tm3d.de/downloads/1wire2.pdf">pdf)</a></span></p>
<h3>Presence-Impuls</h3>
<p>Nach dem Reset-Impuls mus jedes angeschlossene Gerät den 1-Wire Bus 
eine bestimmte Zeit auch Low ziehen. So erkennt der Master, ob überhaupt
 Geräte angeschlossen sind. Dieser Vorgang ist komplett über den 
Timer-Interrupt gesteuert. Der Interrupt für den 1-Wire Eingang ist 
dabei deaktiviert.</p>
<p><a class="linkthumb" target="_blank" title="1-Wire Sequenz und Ablauf im Programm" rel="lightbox[id0]" href="http://www.tm3d.de/images/1_wire_protocol.png"><img alt="1-Wire Sequenz und Ablauf im Programm" src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/aa1e39f406b3ae1712505730711e8b60.png" class="thumb" height="238" width="600"></a><span style="font-size: 8pt;">Zeitlicher Ablauf und Zustände im Mikrocontroller<a href="http://www.tm3d.de/downloads/1wire2c.pdf"> (pdf)</a></span></p>
<h3>Empfangen von Bits und Bytes</h3>
<p>Die Übertragung eines Bits im 1-Wire-Bus geht immer mit einer 
fallenden Flanke einher, die vom Master vorgegeben wird. Damit wird der 
Bus synchronisiert. Diese Flanke löst den Interrupt aus und stellt den 
Timer entsprechen ein für die Überprüfung ob das entsprechende Bit eine 1
 (High-Pegel) oder eine 0 (Low-Pegel) ist. Der Interupt für das Bus-Pin 
wird dann deaktiviert und auf den Timer-Interupt gewartet. Die Timer-ISR
 list dann das Bit aus Speichert es und aktiviert wieder den 
Pin-Change-Interrupt. Das gleiche wiederholt sich für alle 8 Bits. 
Danach wird in der Timer-ISR der Befehl geprüft und die Zustandsvariable
 entsprechen gesetzt.</p>
<h3>1-Wire Timing</h3>
<p>Fünf Zeiten müssen für das Protokoll eingestellt werden:</p>
<table rules="all" border="0" cellpadding="5">
<tbody>
<tr style="background-color: #fffe14;">
<td style="background-color: #ffc852;">Name</td>
<td style="background-color: #ffc852;">Beschreibung</td>
<td style="background-color: #ffc852;">Vorgegebene Zeit</td>
<td style="background-color: #ffc852;">Wert bei 8 MHz/64</td>
<td style="background-color: #ffc852;">Erklärungen</td>
</tr>
<tr>
<td style="background-color: #ffcb57;"><span style="font-size: 10pt;"><code class="preprocessor">OWT_MIN_RESET</code></span></td>
<td style="background-color: #1fd3ff;">Minimale Dauer des Reset-Impulses</td>
<td style="background-color: #1fd3ff;">480 µs normal Wert Annahme 440 µm</td>
<td style="background-color: #1fd3ff;">55</td>
<td style="background-color: #1fd3ff;"></td>
</tr>
<tr>
<td style="background-color: #ffcb57;"><span style="font-size: 10pt;"><code class="preprocessor">OWT_RESET<br>_PRESENCE</code></span></td>
<td style="background-color: #1fd3ff;">Minimale Dauer des Reset-Impulses</td>
<td style="background-color: #1fd3ff;">Master samples den Presence-Impuls nach <br>70 µs</td>
<td style="background-color: #1fd3ff;">4 (32µs)</td>
<td style="background-color: #1fd3ff;">Basierent auf Messwerte</td>
</tr>
<tr>
<td style="background-color: #ffcb57;"><span style="font-size: 10pt;"><code class="preprocessor">OWT_PRESENCE</code></span></td>
<td style="background-color: #1fd3ff;">Pause zwischen Reset Presence-Impuls</td>
<td style="background-color: #1fd3ff;">410 µs bis Master fallende sendet</td>
<td style="background-color: #1fd3ff;">20 (80µs)</td>
<td style="background-color: #1fd3ff;">Bei Problemen erhöhen</td>
</tr>
<tr>
<td style="background-color: #ffcb57;"><span style="font-size: 10pt;"><code class="preprocessor">OWT_READLINE</code></span></td>
<td style="background-color: #1fd3ff;">Zeit zwischen fallander Flanke vom Master und dem Auslesen</td>
<td style="background-color: #1fd3ff;">15 µs</td>
<td style="background-color: #1fd3ff;">3-4 (24-32 µs)</td>
<td style="background-color: #1fd3ff;">Für lange Leitungen sind längere Zeiten sinnvoll</td>
</tr>
<tr>
<td style="background-color: #ffcb57;"><span style="font-size: 10pt;"><code class="preprocessor">OWT_LOWTIME</code></span></td>
<td style="background-color: #1fd3ff;">Dauer des Slave Low-Pegels</td>
<td style="background-color: #1fd3ff;">60 µs</td>
<td style="background-color: #1fd3ff;">3-4 (24-32 µs)</td>
<td style="background-color: #1fd3ff;">Schnelle Master (z.B. DS9490) 
funktionieren nur mit 24 µs korrekt, da der AVR für die Berechnungen für
 das nächste Bit Zeit braucht (DS2423 read, Countercopy, CRC16...)</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>Zu Problemen kam es bei der DS2423-Emulation bei zu langer LOW-TIME. 
Offensichtlich ist der AVR dann noch nicht fertig mit der Berechnung, 
die erst nach dem Ende des Low-Signals erfolgt. Mit 24 µs funktionierte 
es aber bisher ganz gut. Es besteht aber noch die Möglichkeit, 
Berechnungen oder das Kopieren der Zählervariablen in die <span style="font-family: courier new,courier;">PIN_INT</span>
 Funktion zu verschieben.&nbsp; Weiterhin gibt es auch die Möglichkeit 
die LOW-TIME zu splitten, so dass die Berechnungen wärend des 
Low-Signals ausgeführt werden. Wer Probleme hat, soll sich bitte melden,
 dann pflege ich die Änderungen ein. </p><div class="jcomments-links"> <a class="comments-link" href="http://www.tm3d.de/index.php/1-wire-device-mit-avr/13-erklaerungen-zum-1-wire-emulator#addcomment" title="Kommentar schreiben">Kommentar schreiben</a> </div>



<div class="item-separator"></div>
	</div>
						<span class="row-separator"></span>
				</div>

						<div class="items-row cols-2 row-1">
		<div class="item column-1">
		


	


<h1><a name="1wiresearch"></a>Der 1-Wire Search Algorithmus aus Sicht der 1-Wire Slaves</h1>
<p>Hier wird der Search Rom Algorithmus aus sich eines 1-Wire Gerätes 
erklärt. Im Internet wird meistens die Sichtweise des Masters 
beschrieben (z.B. <a target="_blank" href="http://www.maxim-ic.com/app-notes/index.mvp/id/187">APPLICATION NOTE 187</a>). Der Search-Rom Algorithmus besteht aus drei Stufen:</p>
<ol>
<li>Slave sendet ein Bit</li>
<li>Slave sendet Bit negierte</li>
<li>Slave empfängt das Kontrollbit vom Master</li>
</ol>
<p>Entspricht das Kontrollbit dem gesendeten Bit, sogeht kann das 
nächste Bit gesendet werden. Andernfalls geht der 1-Wire Slave in den 
Ruhezustand (OW_SLEEP) über.</p>
<p>&nbsp;<a class="linkthumb" target="_blank" title="1wird3" rel="lightbox[id0]" href="http://www.tm3d.de/images/1wird3.png"><img alt="1wird3" src="tm3d.de%20-%201-Wire%20Device%20mit%20AVR-Dateien/7f76063e2fe63e22b6d1d6b99727a2b5.png" class="thumb" height="500" width="269"></a><span style="font-size: 8pt;">UML für den Search-Rom Algorithmus (<a target="_blank" href="http://www.tm3d.de/downloads/1wire3.pdf">pdf)</a></span></p>
<p>Alle angeschlossenen Geräte durchlaufen die Search-Rom Prozedur 
gleichzeitig. Aus Sicht des Masters werden also die Antworten der Slaves
 mit der logischen Funktion AND verknüpft (sobald ein Slave die Leitung 
auf Low zieht ist wird ein Low gelesen).</p><div class="jcomments-links"> <a class="comments-link" href="http://www.tm3d.de/index.php/1-wire-device-mit-avr/18-der-1-wire-search-algorithmus#addcomment" title="Kommentar schreiben">Kommentar schreiben</a> </div>



<div class="item-separator"></div>
	</div>
						<span class="row-separator"></span>
				</div>

				




	

</div>
</div>
						<div class="clear"></div>
			
			<div class="grid_8" id="user1"><div class="content"></div></div>
			<div class="grid_8" id="user2"></div>
			<div class="grid_8" id="user5"><div class="content"></div></div>
			<div class="clear"></div>
			
			
			<!-- footer -->
			<div class="grid_24" id="footer">
				<div id="foot">
					© 2013 tm3d.de 					
																				| Template based on <a href="http://www.1sr.de/" target="_blank" title="Projekte zu Suchmaschinenoptimierung, Webseitenerstellung, Internet Marketing - Agentur aus Thüringen">1sr.de</a>												   
					 
					 					 					 
										
					
				</div>
			</div>
			<div class="clear"></div>			
		</div>
	
<noscript><!-- reDim - ImageSizer for Joomla --><a title="Joomla - Plugins" href="http://www.redim.de/">ImageSizer for Joomla! Copyright (c)2012 reDim</a></noscript>

<div style="display: none; opacity: 0;" id="mbOverlay"></div><div style="display: none;" id="mbCenter"><div id="mbImage"></div><div style="opacity: 0;" id="mbBottom"><a href="#" id="mbCloseLink"></a><a href="#" id="mbNextLink"></a><a href="#" id="mbPrevLink"></a><div id="mbTitle"></div><div id="mbNumber"></div><div id="mbCaption"></div></div></div></body></html>